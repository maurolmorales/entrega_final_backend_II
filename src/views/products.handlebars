{{>header}}

<div class="container">
  {{#each data.productsData}}
    <div>
      <p><strong>Name: </strong> {{this.title}}</p>
      <p><strong>Description: </strong> {{this.description}}</p>
      <p><strong>Code: </strong> {{this.code}}</p>
      <p><strong>Price: </strong>:{{this.price}}</p>
      <p><strong>Status: </strong>:{{this.status}}</p>
      <p><strong>Stock: </strong>:{{this.stock}}</p>
      <p><strong>Category: </strong>:{{this.category}}</p>
      <span class="commandButtons">
        <a href="/products/{{this.id}}">
          <img src="/img/article.svg" alt="article" class="submitSmallCart" />
        </a>
      {{> buttonAddCart param=this.id}}
      </span>
    </div>
  {{/each}}
  
  <nav class="pagination">
    {{#if data.hasPrevPage}}
      <a href="/products/?page={{data.prevPage}}">Anterior</a>
    {{/if}}
    <span>Página {{data.currentPage}} de {{data.totalPages}}</span>
    {{#if data.hasNextPage}}
      <a href="/products/?page={{data.nextPage}}">Siguiente</a>
    {{/if}}
  </nav>
</div>


<script>
  
  async function agregarAlCarrito(productId) {
    try {
      const response = await fetch(`/api/carts/${productId}`, {
        method: "POST" });

      if (response.ok) {
        // Redirigir a la página de carritos después de la respuesta exitosa
        window.location.href = "/carts";
      } else if (response.status === 401) {
        // Si no está autorizado, redirigir a login
        window.location.href = "/login";
      } else {
        console.error("Error al añadir el producto al carrito");
      }
    } catch (error) {
      console.error("Error en la solicitud:", error);
    }
  }
</script>